<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User List</title>
    <link rel="stylesheet" th:href="@{/css/custom.css}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>

<style>
    td, th {
        padding: 5px;
        margin: 5px;
        font-size: 15px;
    }
</style>

<body>

<div th:replace="fragments/header :: myHeader"></div>

<h1 class="text-center">Users</h1>

<a href="/add" class="btn btn-primary mb-3" style="margin-left: 150px;">Add New User</a>
<button type="button" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addCustModal">
    Add Customer
</button>
<a href="/products_page" class="btn btn-info mb-3">Products</a>

<table border="1" class="table-bordered" style="border-collapse: collapse; width: 80%; margin: auto;">
    <tr>
        <th>ID</th><th>Name</th><th>Email</th><th>Actions</th>
    </tr>
    <tr th:each="user : ${users}">
        <td th:text="${user.id}"></td>
        <td th:text="${user.name}"></td>
        <td th:text="${user.email}"></td>
        <td>
            <a th:href="@{'/edit/' + ${user.id}}" class="btn btn-success">Edit</a>
            <a th:href="@{'/delete/' + ${user.id}}" class="btn btn-danger">Delete</a>
        </td>
    </tr>
</table>

<!-- Modal -->
<div class="modal fade" id="addCustModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Add Customer</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <form id="custAddform">
                    <div class="user_input">
                        <label>Name:</label>
                        <input id="custName" class="form-control" type="text" /><br/>
                    </div>
                    <div class="user_input">
                        <label>Email:</label>
                        <input id="custEmail" class="form-control" type="text" /><br/>
                    </div>
                    <div class="user_input">
                        <label>Mobile No:</label>
                        <input id="custMobile" class="form-control" type="text" /><br/>
                    </div>
                    <div class="user_input">
                        <label>Address:</label>
                        <input id="custAddress" class="form-control" type="text" /><br/>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-success" onclick="saveCustomer()">Save</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

<!-- JavaScript to Save Customer -->
<script>
    function saveCustomer() {
        const data = {
            cname: document.getElementById("custName").value,
            cemail: document.getElementById("custEmail").value,
            cmobile: document.getElementById("custMobile").value,
            cadress: document.getElementById("custAddress").value
        };

        fetch("/api/saveCust", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (response.ok) {
                alert("Customer saved successfully!");
                location.reload(); // refresh the page to show in table
            } else {
                alert("Error saving customer.");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Something went wrong.");
        });
    }
</script>

</body>
</html>

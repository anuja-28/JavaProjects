<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User List</title>
    <link rel="stylesheet" th:href="@{/css/custom.css}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

</head>

<style>
    td, th {
        padding: 5px;
        margin: 5px;
        font-size: 15px;
    }
     .error {
        color: red;
        font-size: 13px;
    }
</style>

<body>

<div th:replace="fragments/header :: myHeader"></div>

<h1 class="text-center">Users</h1>

<a href="/add" class="btn btn-primary mb-3" style="margin-left: 150px;">Add New User</a>
<button type="button" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addCustModal">
    Add Customer
</button>
<a href="/products_page" class="btn btn-info mb-3">Products</a>

<table border="1" class="table-bordered" style="border-collapse: collapse; width: 80%; margin: auto;">
    <tr>
        <th>ID</th><th>Name</th><th>Email</th><th>Actions</th>
    </tr>
    <tr th:each="user : ${users}">
        <td th:text="${user.id}"></td>
        <td th:text="${user.name}"></td>
        <td th:text="${user.email}"></td>
        <td>
            <a th:href="@{'/edit/' + ${user.id}}" class="btn btn-success">Edit</a>
            <a th:href="@{'/delete/' + ${user.id}}" class="btn btn-danger">Delete</a>
        </td>
    </tr>
</table>

<!-- Modal -->
<div class="modal fade" id="addCustModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Add Customer</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <form id="custAddform">
                    <div class="user_input">
                        <label>Name:</label>
                        <input id="custName" class="form-control" type="text" />
                        <div class="error" id="custNameError"></div><br/>
                        
                    </div>
                    <div class="user_input">
                        <label>Email:</label>
                        <input id="custEmail" class="form-control" type="text" />
                        <div class="error" id="custEmailError"></div><br/>
                    </div>
                    <div class="user_input">
                        <label>Mobile No:</label>
                        <input id="custMobile" class="form-control" type="text" />
                        <div class="error" id="custMobileError"></div><br/>
                        <br/>
                    </div>
                    <div class="user_input">
                        <label>Address:</label>
                        <input id="custAddress" class="form-control" type="text" />
                        <div class="error" id="custAddressError"></div><br/>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-success" onclick="saveCustomer()">Save</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

 <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- JavaScript to Save Customer -->
<script>
  function saveCustomer() {
    // Clear old errors
    document.querySelectorAll(".error").forEach(el => el.textContent = "");

    const data = {
        custName: document.getElementById("custName").value,
        custEmail: document.getElementById("custEmail").value,
        custMobile: document.getElementById("custMobile").value,
        custAddress: document.getElementById("custAddress").value
    };

    fetch("/api/saveCust", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(errors => { throw errors });
        }
        return response.text(); // or .json() if your success response is JSON
    })
    .then(result => {
        Swal.fire({
            icon: 'success',
            title: 'Success!',
            text: 'Customer Added!',
            confirmButtonText: 'OK'
        }).then(() => {
            location.reload();
        });
    })
    .catch(errors => {
        // Display field-level validation errors
        for (const field in errors) {
            const errorDiv = document.getElementById(field + "Error");
            if (errorDiv) {
                errorDiv.textContent = errors[field];
            }
        }

        // Optional: show SweetAlert summary
        Swal.fire({
            icon: 'error',
            title: 'Form Error!',
            text: 'Please fix the highlighted errors.',
            confirmButtonText: 'OK'
        });
    });
}

</script>

</body>
</html>
